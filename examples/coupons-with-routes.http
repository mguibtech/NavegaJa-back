### ====================================
### CUPONS COM FILTROS DE ROTA
### Sistema "Cupom de CombustÃ­vel"
### ====================================

### 1. CUPOM GERAL (Funciona em QUALQUER rota)
### Como cupom de combustÃ­vel que vale em QUALQUER posto
POST http://localhost:3000/coupons
Content-Type: application/json
Authorization: Bearer {{admin_token}}

{
  "code": "VERAO2026",
  "description": "20% de desconto em TODAS as viagens do verÃ£o",
  "type": "percentage",
  "value": 20,
  "minPurchase": 50,
  "maxDiscount": 100,
  "validFrom": "2026-02-01T00:00:00Z",
  "validUntil": "2026-03-31T23:59:59Z",
  "isActive": true,
  "fromCity": null,
  "toCity": null
}

### RESPONSE:
# {
#   "id": "coupon-123",
#   "code": "VERAO2026",
#   "type": "percentage",
#   "value": 20,
#   "fromCity": null,   // â† null = vale para TODAS as rotas
#   "toCity": null
# }

###

### 2. CUPOM PARA ROTA ESPECÃFICA (Origem E Destino)
### Como cupom de combustÃ­vel que sÃ³ vale em 1 posto especÃ­fico
POST http://localhost:3000/coupons
Content-Type: application/json
Authorization: Bearer {{admin_token}}

{
  "code": "BERURI15",
  "description": "R$ 15 OFF apenas em viagens Manaus â†’ Beruri",
  "type": "fixed",
  "value": 15,
  "validFrom": "2026-02-01T00:00:00Z",
  "validUntil": "2026-12-31T23:59:59Z",
  "isActive": true,
  "fromCity": "Manaus",
  "toCity": "Beruri"
}

### RESPONSE:
# {
#   "id": "coupon-456",
#   "code": "BERURI15",
#   "type": "fixed",
#   "value": 15,
#   "fromCity": "Manaus",   // â† SÃ³ viagens que saem de Manaus
#   "toCity": "Beruri"       // â† SÃ³ viagens que vÃ£o para Beruri
# }

###

### 3. CUPOM PARA QUALQUER DESTINO DE UMA ORIGEM
### Como cupom que vale em qualquer posto de uma rede especÃ­fica
POST http://localhost:3000/coupons
Content-Type: application/json
Authorization: Bearer {{admin_token}}

{
  "code": "MANAUS10",
  "description": "10% OFF em viagens saindo de Manaus (qualquer destino)",
  "type": "percentage",
  "value": 10,
  "validFrom": "2026-02-01T00:00:00Z",
  "validUntil": "2026-12-31T23:59:59Z",
  "isActive": true,
  "fromCity": "Manaus",
  "toCity": null
}

### RESPONSE:
# {
#   "id": "coupon-789",
#   "code": "MANAUS10",
#   "fromCity": "Manaus",   // â† SÃ³ viagens que saem de Manaus
#   "toCity": null          // â† Pode ir para QUALQUER destino
# }

###

### 4. CUPOM PARA QUALQUER ORIGEM ATÃ‰ UM DESTINO
POST http://localhost:3000/coupons
Content-Type: application/json
Authorization: Bearer {{admin_token}}

{
  "code": "CHEGABERU",
  "description": "R$ 20 OFF chegando em Beruri (de qualquer origem)",
  "type": "fixed",
  "value": 20,
  "validFrom": "2026-02-01T00:00:00Z",
  "validUntil": "2026-12-31T23:59:59Z",
  "isActive": true,
  "fromCity": null,
  "toCity": "Beruri"
}

### RESPONSE:
# {
#   "id": "coupon-999",
#   "code": "CHEGABERU",
#   "fromCity": null,      // â† Pode sair de QUALQUER cidade
#   "toCity": "Beruri"     // â† SÃ³ viagens que vÃ£o para Beruri
# }

###

### ====================================
### APP: Listar cupons ativos
### ====================================
GET http://localhost:3000/coupons/active

### RESPONSE:
# {
#   "coupons": [
#     {
#       "code": "VERAO2026",
#       "description": "20% de desconto em TODAS as viagens do verÃ£o",
#       "type": "percentage",
#       "value": 20,
#       "minPurchase": 50,
#       "maxDiscount": 100,
#       "validUntil": "2026-03-31T23:59:59Z"
#     },
#     {
#       "code": "BERURI15",
#       "description": "R$ 15 OFF apenas em viagens Manaus â†’ Beruri",
#       "type": "fixed",
#       "value": 15,
#       "validUntil": "2026-12-31T23:59:59Z"
#     }
#   ]
# }

###

### ====================================
### APP: Validar cupom NO CHECKOUT
### ====================================

### CASO 1: Cupom vÃ¡lido para a rota
POST http://localhost:3000/coupons/validate
Content-Type: application/json

{
  "code": "BERURI15",
  "tripId": "trip-abc-123",
  "quantity": 2
}

### RESPONSE (SUCESSO):
# {
#   "valid": true,
#   "coupon": {
#     "code": "BERURI15",
#     "type": "fixed",
#     "value": 15
#   },
#   "originalPrice": 200.00,    // 2 passagens Ã— R$ 100
#   "discount": 15.00,
#   "finalPrice": 185.00,       // R$ 200 - R$ 15
#   "savedAmount": 15.00
# }

###

### CASO 2: Cupom INVÃLIDO para a rota (filtros nÃ£o batem)
POST http://localhost:3000/coupons/validate
Content-Type: application/json

{
  "code": "BERURI15",
  "tripId": "trip-manaus-manacapuru",
  "quantity": 1
}

### RESPONSE (ERRO):
# {
#   "valid": false,
#   "message": "Este cupom sÃ³ vale para viagens indo para Beruri"
# }

###

### CASO 3: Cupom expirado
POST http://localhost:3000/coupons/validate
Content-Type: application/json

{
  "code": "NATAL2025",
  "tripId": "trip-abc-123",
  "quantity": 1
}

### RESPONSE (ERRO):
# {
#   "valid": false,
#   "message": "Cupom expirado"
# }

###

### CASO 4: Valor mÃ­nimo nÃ£o atingido
POST http://localhost:3000/coupons/validate
Content-Type: application/json

{
  "code": "VERAO2026",
  "tripId": "trip-barato-30-reais",
  "quantity": 1
}

### RESPONSE (ERRO):
# {
#   "valid": false,
#   "message": "Valor mÃ­nimo de compra: R$ 50.00"
# }

###

### CASO 5: Cupom esgotado (atingiu limite de uso)
POST http://localhost:3000/coupons/validate
Content-Type: application/json

{
  "code": "LIMITED100",
  "tripId": "trip-abc-123",
  "quantity": 1
}

### RESPONSE (ERRO):
# {
#   "valid": false,
#   "message": "Cupom esgotado"
# }

###

### ====================================
### RESUMO: Como funciona a validaÃ§Ã£o
### ====================================
#
# A validaÃ§Ã£o do cupom verifica (NESTA ORDEM):
#
# 1. âœ… Cupom existe?
# 2. âœ… Cupom estÃ¡ ativo?
# 3. âœ… Cupom estÃ¡ dentro do perÃ­odo de validade?
# 4. âœ… Cupom nÃ£o atingiu limite de uso?
# 5. âœ… Valor mÃ­nimo de compra foi atingido?
# 6. âœ… Cupom vale para essa rota? (fromCity/toCity)
#    - Se fromCity != null: viagem deve sair dessa cidade
#    - Se toCity != null: viagem deve ir para essa cidade
#    - Se ambos null: vale para QUALQUER rota
#
# 7. ðŸ’° Calcular desconto:
#    - Percentage: (preÃ§o Ã— valor) / 100
#    - Fixed: valor fixo
#    - Aplicar maxDiscount se houver
#

###

### ====================================
### EXEMPLOS DE USO NO APP
### ====================================
#
# CENÃRIO 1: Cupom genÃ©rico
# - Admin cria cupom "VERAO2026" (fromCity: null, toCity: null)
# - UsuÃ¡rio pode usar em QUALQUER viagem
# - Como cupom de combustÃ­vel que vale em qualquer posto
#
# CENÃRIO 2: Cupom de rota especÃ­fica
# - Admin cria cupom "BERURI15" (fromCity: "Manaus", toCity: "Beruri")
# - UsuÃ¡rio SÃ“ pode usar em viagens Manaus â†’ Beruri
# - Como cupom que sÃ³ vale em 1 posto especÃ­fico
#
# CENÃRIO 3: Cupom de origem especÃ­fica
# - Admin cria cupom "MANAUS10" (fromCity: "Manaus", toCity: null)
# - UsuÃ¡rio pode usar em qualquer viagem que saia de Manaus
# - Como cupom que vale em qualquer posto da rede X
#
# CENÃRIO 4: Cupom de destino especÃ­fico
# - Admin cria cupom "CHEGABERU" (fromCity: null, toCity: "Beruri")
# - UsuÃ¡rio pode usar em qualquer viagem que vÃ¡ para Beruri
# - Como cupom para chegar em um local especÃ­fico
#

###

### ====================================
### FLUXO COMPLETO NO APP
### ====================================
#
# 1. USUÃRIO VÃŠ BANNER DE PROMOÃ‡ÃƒO
#    â””â”€> GET /promotions/active
#    â””â”€> VÃª "VERAO2026 - 20% OFF em todas as viagens"
#
# 2. USUÃRIO BUSCA VIAGEM
#    â””â”€> GET /trips/search?from=Manaus&to=Beruri
#    â””â”€> Escolhe viagem (R$ 100,00)
#
# 3. USUÃRIO VAI PARA CHECKOUT
#    â””â”€> Digita cupom "VERAO2026"
#    â””â”€> POST /coupons/validate { code: "VERAO2026", tripId: "...", quantity: 1 }
#
# 4. BACKEND VALIDA
#    âœ… Cupom existe
#    âœ… EstÃ¡ ativo
#    âœ… NÃ£o expirou
#    âœ… NÃ£o esgotou
#    âœ… Valor mÃ­nimo OK (R$ 100 >= R$ 50)
#    âœ… Rota OK (fromCity: null = qualquer rota)
#    ðŸ’° Desconto: 20% de R$ 100 = R$ 20
#
# 5. APP MOSTRA DESCONTO
#    â””â”€> "Desconto aplicado! De R$ 100 por R$ 80"
#
# 6. USUÃRIO CONFIRMA COMPRA
#    â””â”€> POST /bookings { tripId, seats: 1, couponCode: "VERAO2026" }
#    â””â”€> Backend aplica desconto e incrementa usageCount
#
